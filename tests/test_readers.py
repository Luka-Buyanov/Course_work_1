from typing import Any
from unittest.mock import patch

import pandas as pd

from src.readers import excel_reader


@patch("pandas.read_excel")
def test_correct_input(data: Any) -> None:
    """Функция проверяющая работу при корректной ситуации"""

    data.return_value = pd.DataFrame(
        [
            {
                "Дата операции": "14.01.2018 14:10:58",
                "Дата платежа": "15.01.2018",
                "Номер карты": "*7197",
                "Статус": "OK",
                "Сумма операции": -1.0,
                "Валюта операции": "EUR",
                "Сумма платежа": -70.2,
                "Валюта платежа": "RUB",
                "Кэшбэк": 0,
                "Категория": "Рестораны",
                "MCC": 5812.0,
                "Описание": "Luhamaa Terminal  kohvik",
                "Бонусы (включая кэшбэк)": 1,
                "Округление на инвесткопилку": 0,
                "Сумма операции с округлением": 70.2,
            },
            {
                "Дата операции": "14.01.2018 10:43:42",
                "Дата платежа": "15.01.2018",
                "Номер карты": "*7197",
                "Статус": "OK",
                "Сумма операции": -1.42,
                "Валюта операции": "EUR",
                "Сумма платежа": -99.68,
                "Валюта платежа": "RUB",
                "Кэшбэк": 0,
                "Категория": "Супермаркеты",
                "MCC": 5411.0,
                "Описание": 'Rimi Hm "Alfa"',
                "Бонусы (включая кэшбэк)": 1,
                "Округление на инвесткопилку": 0,
                "Сумма операции с округлением": 99.68,
            },
            {
                "Дата операции": "12.01.2018 16:38:58",
                "Дата платежа": "15.01.2018",
                "Номер карты": "*7197",
                "Статус": "OK",
                "Сумма операции": -4.62,
                "Валюта операции": "EUR",
                "Сумма платежа": -324.32,
                "Валюта платежа": "RUB",
                "Кэшбэк": 0,
                "Категория": "Различные товары",
                "MCC": 5311.0,
                "Описание": "Maxima Lv R010",
                "Бонусы (включая кэшбэк)": 6,
                "Округление на инвесткопилку": 0,
                "Сумма операции с округлением": 324.32,
            },
            {
                "Дата операции": "12.01.2018 16:15:56",
                "Дата платежа": "15.01.2018",
                "Номер карты": "*7197",
                "Статус": "OK",
                "Сумма операции": -26.56,
                "Валюта операции": "EUR",
                "Сумма платежа": -1864.51,
                "Валюта платежа": "RUB",
                "Кэшбэк": 0,
                "Категория": "Одежда и обувь",
                "MCC": 5641.0,
                "Описание": "Varaviksne-veikals",
                "Бонусы (включая кэшбэк)": 37,
                "Округление на инвесткопилку": 0,
                "Сумма операции с округлением": 1864.51,
            },
            {
                "Дата операции": "12.01.2018 16:04:18",
                "Дата платежа": "15.01.2018",
                "Номер карты": "*7197",
                "Статус": "OK",
                "Сумма операции": -6.96,
                "Валюта операции": "EUR",
                "Сумма платежа": -488.59,
                "Валюта платежа": "RUB",
                "Кэшбэк": 0,
                "Категория": "Одежда и обувь",
                "MCC": 5641.0,
                "Описание": "Varaviksne-veikals",
                "Бонусы (включая кэшбэк)": 9,
                "Округление на инвесткопилку": 0,
                "Сумма операции с округлением": 488.59,
            },
            {
                "Дата операции": "12.01.2018 15:58:01",
                "Дата платежа": "15.01.2018",
                "Номер карты": "*7197",
                "Статус": "OK",
                "Сумма операции": -28.29,
                "Валюта операции": "EUR",
                "Сумма платежа": -1985.96,
                "Валюта платежа": "RUB",
                "Кэшбэк": 0,
                "Категория": "Одежда и обувь",
                "MCC": 5641.0,
                "Описание": "Varaviksne-veikals",
                "Бонусы (включая кэшбэк)": 39,
                "Округление на инвесткопилку": 0,
                "Сумма операции с округлением": 1985.96,
            },
        ]
    )

    assert excel_reader() == [
        {
            "MCC": 5812.0,
            "Бонусы (включая кэшбэк)": 1,
            "Валюта операции": "EUR",
            "Валюта платежа": "RUB",
            "Дата операции": "14.01.2018 14:10:58",
            "Дата платежа": "15.01.2018",
            "Категория": "Рестораны",
            "Кэшбэк": 0,
            "Номер карты": "*7197",
            "Округление на инвесткопилку": 0,
            "Описание": "Luhamaa Terminal  kohvik",
            "Статус": "OK",
            "Сумма операции": -1.0,
            "Сумма операции с округлением": 70.2,
            "Сумма платежа": -70.2,
        },
        {
            "MCC": 5411.0,
            "Бонусы (включая кэшбэк)": 1,
            "Валюта операции": "EUR",
            "Валюта платежа": "RUB",
            "Дата операции": "14.01.2018 10:43:42",
            "Дата платежа": "15.01.2018",
            "Категория": "Супермаркеты",
            "Кэшбэк": 0,
            "Номер карты": "*7197",
            "Округление на инвесткопилку": 0,
            "Описание": 'Rimi Hm "Alfa"',
            "Статус": "OK",
            "Сумма операции": -1.42,
            "Сумма операции с округлением": 99.68,
            "Сумма платежа": -99.68,
        },
        {
            "MCC": 5311.0,
            "Бонусы (включая кэшбэк)": 6,
            "Валюта операции": "EUR",
            "Валюта платежа": "RUB",
            "Дата операции": "12.01.2018 16:38:58",
            "Дата платежа": "15.01.2018",
            "Категория": "Различные товары",
            "Кэшбэк": 0,
            "Номер карты": "*7197",
            "Округление на инвесткопилку": 0,
            "Описание": "Maxima Lv R010",
            "Статус": "OK",
            "Сумма операции": -4.62,
            "Сумма операции с округлением": 324.32,
            "Сумма платежа": -324.32,
        },
        {
            "MCC": 5641.0,
            "Бонусы (включая кэшбэк)": 37,
            "Валюта операции": "EUR",
            "Валюта платежа": "RUB",
            "Дата операции": "12.01.2018 16:15:56",
            "Дата платежа": "15.01.2018",
            "Категория": "Одежда и обувь",
            "Кэшбэк": 0,
            "Номер карты": "*7197",
            "Округление на инвесткопилку": 0,
            "Описание": "Varaviksne-veikals",
            "Статус": "OK",
            "Сумма операции": -26.56,
            "Сумма операции с округлением": 1864.51,
            "Сумма платежа": -1864.51,
        },
        {
            "MCC": 5641.0,
            "Бонусы (включая кэшбэк)": 9,
            "Валюта операции": "EUR",
            "Валюта платежа": "RUB",
            "Дата операции": "12.01.2018 16:04:18",
            "Дата платежа": "15.01.2018",
            "Категория": "Одежда и обувь",
            "Кэшбэк": 0,
            "Номер карты": "*7197",
            "Округление на инвесткопилку": 0,
            "Описание": "Varaviksne-veikals",
            "Статус": "OK",
            "Сумма операции": -6.96,
            "Сумма операции с округлением": 488.59,
            "Сумма платежа": -488.59,
        },
        {
            "MCC": 5641.0,
            "Бонусы (включая кэшбэк)": 39,
            "Валюта операции": "EUR",
            "Валюта платежа": "RUB",
            "Дата операции": "12.01.2018 15:58:01",
            "Дата платежа": "15.01.2018",
            "Категория": "Одежда и обувь",
            "Кэшбэк": 0,
            "Номер карты": "*7197",
            "Округление на инвесткопилку": 0,
            "Описание": "Varaviksne-veikals",
            "Статус": "OK",
            "Сумма операции": -28.29,
            "Сумма операции с округлением": 1985.96,
            "Сумма платежа": -1985.96,
        },
    ]


def test_wrong_path() -> None:
    """Функция проверяющая обработку ошибки FileNotFound"""

    assert excel_reader("wehfwevfweu") == [{"error": "Ошибка, файл не найден"}]
